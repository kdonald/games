<!DOCTYPE html>
<html>
  <head>
    <title>Brevard Zoo Animal Cards</title>
    <script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
    <link rel="stylesheet" href="index.css" />
    <meta name="description" content="A fun animal matching game that tests your memory."> 
  </head>
  <body>
    <h1>Brevard Zoo Animal Cards</h1>
    <h3>an ACD production (v1.0)</h3>
    <p>If this is your first time playing, <a href="">read the rules</a>.
    <div id="rules" class="hidden">
      <p>
        Brevard Zoo Animal Cards is a fun matching game that exercises your memory.
      </p>
      <p>
        There is a board of ten cards.
        Each card when turned over reveals an animal.
        There are five distinct animals and a pair of cards for each animal.
      </p>
      <p>
        The game starts when the board's cards are turned over and shuffled.
        The first player draws a card from the pick 'em deck.
        The card reveals an animal.
        The player attempts to match the animal on the board.
        If she finds a match she earns another turn.
        If she matches the pair, she collects the pair and wins a point.
        If she fails to match the pair, any previous match is turned back over and the next player gets a turn.
      </p>
      <p>
        A player wins when she gets 3 points by matching 3 pairs of animals.
      </p>
      <p>
        Enjoy playing! -  Annabelle and Corgan, Animal Card Designers
      </p>
    </div>    
    <div id="board"></div>    
    <div id="control">
      <div id="score">
        <label>
          Player 1:
          <strong>0</strong>
        </label>
        <label>
          Player 2:
          <strong>0</strong>
        </label>        
      </div>
      <div id="playersTurn">
        <label>
          Turn:
          <strong>Player 1</strong>
        </label>  
      </div>
      <button>Pick a card</button>
      <div id="animal"></div>      
    </div>
  </body>
  <script>
  
  $("p > a").click(function() {
    $("#rules").toggleClass("hidden");
    return false;
  });
  
  var i, j = 0, numberOfCards = 10, boardElement = $("#board"), pickCardButton = $("button"), animalElement = $("#animal"), animal, matches = 0, firstMatch, picking = false, pickListener = {};
  var animals = [ "Rhino", "Jaguar", "Giraffe", "Monkey", "Cheetah"] ;
  var board = new Array(numberOfCards);
  for (i = 0; i < numberOfCards; i+= 2) {
    board[i] = animals[j];    
    board[i+1] = animals[j];
    j += 1;
  }

  shuffle(board);
  
  for (i = 0; i < board.length; i += 1) {
    boardElement.append(makeCardElement(board[i], i));
  }
  
  function makeCardElement(card, i) {
    var cardElement = $("<div/>").attr("id", "card-" + (i+1)).addClass("card").addClass("turned-over");
    cardElement.click(function() {
      if (!picking) {
        return false;
      }
      var self = $(this)
      self.removeClass("turned-over");
      self.addClass(card);
      if (!pickListener.onPick(card, cardElement)) {
        setTimeout(function() {
          self.addClass("turned-over");
          self.removeClass(card); 
          if (firstMatch) {
            firstMatch.removeClass();
            firstMatch.addClass("card");            
            firstMatch.addClass("turned-over");
          }         
        }, 2000)
      }
      return false;
    });
    return cardElement;
  }

  pickCardButton.click(function() {
    animal = animals[Math.floor(Math.random() * animals.length)];
    animalElement.removeClass();
    animalElement.addClass(animal);    
    picking = true;
    pickCardButton.attr("disabled", true);
    return false;
  });

  pickListener.onPick = function(card, cardElement) {
    if (card === animal) {
      console.log("Matched", card);      
      matches += 1;
      firstMatch = cardElement;
      if (matches == 2) {
        console.log("Won a point! Collecting pair...");
        matches = 0;
        picking = false;
        pickCardButton.attr("disabled", false);        
        animal = null;
        animalElement.removeClass();        
      }
      return true;
    } else {
      matches = 0;
      picking = false;
      pickCardButton.attr("disabled", false);
      animal = null;
      animalElement.removeClass();
      return false;
    }
  };
    
  function shuffle(array) {
    var tmp, current, top = array.length;
    if (top) while(--top) {
      current = Math.floor(Math.random() * (top + 1));
      tmp = array[current];
      array[current] = array[top];
      array[top] = tmp;
    }
    return array;
  }  
  </script>
</html>